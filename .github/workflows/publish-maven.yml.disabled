name: Publish to Maven Central

# âš ï¸  IMPORTANTE: Este workflow estÃ¡ DESABILITADO por padrÃ£o
# Para habilitar:
# 1. Renomeie este arquivo de publish-maven.yml.disabled para publish-maven.yml
# 2. Configure os secrets no GitHub (veja instruÃ§Ãµes abaixo)

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:  # Permite execuÃ§Ã£o manual

jobs:
  publish: 
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Setup JDK 21
      uses: actions/setup-java@v4
      with:
        java-version: '21'
        distribution: 'temurin'
        cache: 'sbt'
    
    - name: Import GPG key
      run: |
        echo "${{ secrets.PGP_SECRET }}" | base64 --decode | gpg --batch --import
        gpg --list-secret-keys --keyid-format LONG
    
    - name: Run tests
      run: sbt test
    
    - name: Publish to Sonatype (staging)
      run: sbt publishSigned
      env:
        PGP_PASSPHRASE: ${{ secrets.PGP_PASSPHRASE }}
        SONATYPE_USERNAME: ${{ secrets.SONATYPE_USERNAME }}
        SONATYPE_PASSWORD: ${{ secrets.SONATYPE_PASSWORD }}
    
    - name: Release to Maven Central
      run: sbt sonatypeBundleRelease
      env:
        SONATYPE_USERNAME: ${{ secrets.SONATYPE_USERNAME }}
        SONATYPE_PASSWORD: ${{ secrets.SONATYPE_PASSWORD }}
    
    - name: Extract version
      id: version
      run: echo "VERSION=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT
    
    - name: Create GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        name: Release ${{ steps.version.outputs.VERSION }}
        body: |
          ## ğŸ‰ Published to Maven Central!
          
          ### ğŸ“¦ Installation
          
          Add to your `build.sbt`:
          
          ```scala
          libraryDependencies += "io.github.fwrock" %% "htc-dl" % "${{ steps.version.outputs.VERSION }}"
          ```
          
          ### ğŸ”— Links
          
          - **Maven Central**: https://search.maven.org/artifact/io.github.fwrock/htc-dl_3/${{ steps.version.outputs.VERSION }}/jar
          - **Scaladex**: https://index.scala-lang.org/fwrock/htc-dl (available in 2-24 hours)
          
          ### â±ï¸ Availability
          
          - âœ… Maven Central: 10-30 minutes
          - â³ Scaladex: 2-24 hours (automatic indexing)
          
          ### ğŸ“ Changes
          
          See [CHANGELOG.md](CHANGELOG.md) for details.
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“‹ INSTRUÃ‡Ã•ES PARA CONFIGURAR SECRETS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# VÃ¡ em: GitHub â†’ Settings â†’ Secrets and variables â†’ Actions
#
# Configure os seguintes secrets:
#
# 1ï¸âƒ£  SONATYPE_USERNAME
#     Valor: seu username do Sonatype OSS
#     Como obter: https://s01.oss.sonatype.org/ (apÃ³s criar conta)
#
# 2ï¸âƒ£  SONATYPE_PASSWORD  
#     Valor: sua senha do Sonatype OSS
#     Como obter: a mesma senha que vocÃª usa para login
#
# 3ï¸âƒ£  PGP_SECRET
#     Valor: sua chave GPG privada em base64
#     Como obter:
#       gpg --export-secret-keys SEU_KEY_ID | base64 -w 0
#     
#     (Copie TODO o output - serÃ¡ uma string MUITO longa)
#
# 4ï¸âƒ£  PGP_PASSPHRASE
#     Valor: a senha da sua chave GPG
#     Como obter: Ã© a senha que vocÃª definiu ao criar a chave GPG
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“š PRÃ‰-REQUISITOS ANTES DE HABILITAR
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# âœ… Conta Sonatype criada e APROVADA
#    Tutorial: SCALADEX_PUBLISHING.md
#
# âœ… Chave GPG gerada e publicada
#    Comando: gpg --gen-key
#    Publicar: gpg --keyserver keyserver.ubuntu.com --send-keys KEY_ID
#
# âœ… Arquivo ~/.sbt/1.0/sonatype.sbt configurado localmente
#    (para testar antes de automatizar)
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸš€ COMO HABILITAR ESTE WORKFLOW
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# OpÃ§Ã£o 1 - Via Terminal:
#   mv .github/workflows/publish-maven.yml.disabled \
#      .github/workflows/publish-maven.yml
#
# OpÃ§Ã£o 2 - Via GitHub:
#   Renomeie o arquivo removendo o .disabled do final
#
# Depois:
#   git add .github/workflows/publish-maven.yml
#   git commit -m "Enable Maven Central publishing"
#   git push
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ¯ COMO USAR (apÃ³s habilitar)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# 1. Atualizar versÃ£o em build.sbt:
#    ThisBuild / version := "0.1.0"
#
# 2. Commit e criar tag:
#    git add .
#    git commit -m "Release 0.1.0"
#    git tag v0.1.0
#    git push origin main --tags
#
# 3. Aguardar workflow completar (~5-10 minutos)
#
# 4. Verificar publicaÃ§Ã£o:
#    Maven Central: https://search.maven.org/
#    Scaladex: https://index.scala-lang.org/ (apÃ³s 2-24h)
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
